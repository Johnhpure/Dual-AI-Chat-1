# 阿里云服务器部署指南

本指南详细说明如何将Dual-AI-Chat项目部署到阿里云轻量应用服务器。

## 前提条件

1. 已有阿里云服务器（IP: 47.79.145.239）
2. 已安装Docker和Docker Compose
3. 有服务器的SSH访问权限（用户名: root）

## 部署方法

### 方法1：使用部署脚本（推荐）

1. 在本地项目目录中，确保已创建`.env`文件并填写API密钥：
   ```bash
   cp docker-env.example .env
   # 编辑.env文件，填写API密钥
   ```

2. 运行部署脚本：
   ```bash
   ./deploy.sh
   ```
   
   脚本会自动执行以下操作：
   - 打包项目文件
   - 上传到服务器
   - 在服务器上解压文件
   - 构建并启动Docker容器
   - 清理临时文件

3. 部署完成后，可以通过以下地址访问应用：
   ```
   http://47.79.145.239:8080
   ```

### 方法2：手动部署

1. 登录到服务器：
   ```bash
   ssh root@47.79.145.239
   ```

2. 创建项目目录：
   ```bash
   mkdir -p /opt/dual-ai-chat
   cd /opt/dual-ai-chat
   ```

3. 克隆代码仓库或上传项目文件：
   ```bash
   git clone <仓库URL> .
   # 或者通过SFTP/SCP上传项目文件
   ```

4. 创建环境变量文件：
   ```bash
   cp docker-env.example .env
   # 编辑.env文件，填写API密钥
   ```

5. 构建并启动Docker容器：
   ```bash
   docker-compose up -d
   ```

6. 访问应用：
   ```
   http://47.79.145.239:8080
   ```

## 更新应用

### 使用部署脚本更新

重新运行部署脚本即可：
```bash
./deploy.sh
```

### 手动更新

1. 登录到服务器：
   ```bash
   ssh root@47.79.145.239
   ```

2. 进入项目目录：
   ```bash
   cd /opt/dual-ai-chat
   ```

3. 拉取最新代码（如果使用Git）：
   ```bash
   git pull
   ```

4. 重新构建并启动容器：
   ```bash
   docker-compose down
   docker-compose up -d --build
   ```

## 故障排查

1. 检查容器状态：
   ```bash
   docker-compose ps
   ```

2. 查看容器日志：
   ```bash
   docker-compose logs
   ```

3. 检查Nginx配置：
   ```bash
   docker-compose exec dual-ai-chat nginx -t
   ```

4. 检查网络连接：
   ```bash
   curl http://localhost:80
   ```

5. 如果应用无法访问，检查服务器防火墙是否开放8080端口：
   ```bash
   ufw status
   # 如需开放端口
   ufw allow 8080/tcp
   ```
